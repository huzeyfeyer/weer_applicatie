<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Weekly Weather Forecast - Open Meteo</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
  :root {
    --color-bg: #0a1f44;
    --color-primary: #133b5c;
    --color-accent: #4ca1af;
    --color-text: #e0e6f1;
    --color-subtext: #a0b8d9;
    --border-radius: 12px;
    --spacing: 16px;
    --max-width: 960px;
  }
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: linear-gradient(135deg, var(--color-bg), var(--color-primary));
    color: var(--color-text);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--spacing);
  }
  header {
    width: 100%;
    max-width: var(--max-width);
    padding: var(--spacing);
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 32px;
  }
  header h1 {
    margin: 0 0 8px 0;
    font-weight: 700;
    font-size: 2rem;
    letter-spacing: 1.2px;
    text-align: center;
  }
  header form {
    display: flex;
    width: 100%;
    max-width: 360px;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: center;
  }
  header input[type="number"] {
    padding: 10px 12px;
    border-radius: var(--border-radius);
    border: none;
    font-size: 1rem;
    font-weight: 400;
    outline-offset: 3px;
    width: 140px;
  }
  header label {
    font-size: 0.9rem;
    color: var(--color-subtext);
    margin-bottom: 2px;
    display: block;
    font-weight: 600;
  }
  header button {
    background-color: var(--color-accent);
    border: none;
    color: var(--color-text);
    padding: 10px 16px;
    font-weight: 700;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: background-color 0.3s ease;
    width: 100%;
    max-width: 120px;
  }
  header button:hover,
  header button:focus {
    background-color: #3a9083;
  }
  main {
    width: 100%;
    max-width: var(--max-width);
    display: grid;
    gap: 24px;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
  }
  .day-card {
    background: var(--color-primary);
    border-radius: var(--border-radius);
    padding: 16px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    transition: transform 0.3s ease;
  }
  .day-card:hover,
  .day-card:focus-within {
    transform: translateY(-6px);
    box-shadow: 0 12px 24px rgba(0,0,0,0.45);
  }
  .day-name {
    font-weight: 700;
    font-size: 1.25rem;
    margin-bottom: 8px;
  }
  .icon {
    width: 64px;
    height: 64px;
    margin-bottom: 8px;
  }
  .temp {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 4px;
  }
  .temp-min {
    color: var(--color-subtext);
    font-weight: 400;
    font-size: 0.9rem;
    margin-bottom: 6px;
  }
  .precip {
    font-size: 0.9rem;
    color: var(--color-subtext);
  }
  .error {
    color: #e65252;
    font-weight: 700;
    text-align: center;
    margin-top: 24px;
  }
  @media (max-width: 480px) {
    header form {
      max-width: 100%;
      flex-direction: column;
      align-items: center;
    }
    header input[type="number"] {
      width: 100%;
      max-width: 280px;
    }
    header button {
      max-width: none;
      width: 100%;
    }
  }
</style>
</head>
<body>
<header>
  <h1>Weekly Weather Forecast - Open Meteo</h1>
  <form id="coord-form" aria-label="Location coordinate form">
    <div>
      <label for="latitude">Latitude</label>
      <input type="number" step="0.0001" id="latitude" name="latitude" min="-90" max="90" value="50.8505" required aria-required="true" />
    </div>
    <div>
      <label for="longitude">Longitude</label>
      <input type="number" step="0.0001" id="longitude" name="longitude" min="-180" max="180" value="4.3488" required aria-required="true" />
    </div>
    <button type="submit" aria-label="Get weekly forecast">Get Forecast</button>
  </form>
  <p id="error-message" class="error" role="alert" aria-live="polite"></p>
</header>
<main id="forecast-container" aria-live="polite" aria-label="Weekly weather forecast">
  <!-- Daily forecast cards here -->
</main>

<script>
  const weatherCodeMap = {
    0: { text: 'Clear sky', icon: 'â˜€ï¸' },
    1: { text: 'Mainly clear', icon: 'ğŸŒ¤ï¸' },
    2: { text: 'Partly cloudy', icon: 'â›…' },
    3: { text: 'Overcast', icon: 'â˜ï¸' },
    45: { text: 'Fog', icon: 'ğŸŒ«ï¸' },
    48: { text: 'Depositing rime fog', icon: 'ğŸŒ«ï¸' },
    51: { text: 'Light drizzle', icon: 'ğŸŒ¦ï¸' },
    53: { text: 'Moderate drizzle', icon: 'ğŸŒ¦ï¸' },
    55: { text: 'Dense drizzle', icon: 'ğŸŒ§ï¸' },
    56: { text: 'Light freezing drizzle', icon: 'ğŸŒ§ï¸â„ï¸' },
    57: { text: 'Dense freezing drizzle', icon: 'ğŸŒ§ï¸â„ï¸' },
    61: { text: 'Slight rain', icon: 'ğŸŒ§ï¸' },
    63: { text: 'Moderate rain', icon: 'ğŸŒ§ï¸' },
    65: { text: 'Heavy rain', icon: 'ğŸŒ§ï¸' },
    66: { text: 'Light freezing rain', icon: 'ğŸŒ¨ï¸' },
    67: { text: 'Heavy freezing rain', icon: 'ğŸŒ¨ï¸' },
    71: { text: 'Slight snow fall', icon: 'ğŸŒ¨ï¸' },
    73: { text: 'Moderate snow fall', icon: 'ğŸŒ¨ï¸' },
    75: { text: 'Heavy snow fall', icon: 'â„ï¸' },
    77: { text: 'Snow grains', icon: 'â„ï¸' },
    80: { text: 'Slight showers', icon: 'ğŸŒ§ï¸' },
    81: { text: 'Moderate showers', icon: 'ğŸŒ§ï¸' },
    82: { text: 'Violent showers', icon: 'â›ˆï¸' },
    85: { text: 'Slight snow showers', icon: 'ğŸŒ¨ï¸' },
    86: { text: 'Heavy snow showers', icon: 'â„ï¸' },
    95: { text: 'Thunderstorm', icon: 'â›ˆï¸' },
    96: { text: 'Thunderstorm with slight hail', icon: 'â›ˆï¸' },
    99: { text: 'Thunderstorm with heavy hail', icon: 'â›ˆï¸' }
  };

  // Format date string (YYYY-MM-DD) to short weekday name
  function getDayName(dateStr) {
    const date = new Date(dateStr);
    return date.toLocaleDateString(undefined, { weekday: 'short' });
  }

  // Format temperature to rounded celsius with Â°C
  function formatTemp(temp) {
    return `${Math.round(temp)}Â°C`;
  }

  function clearError() {
    document.getElementById('error-message').textContent = '';
  }

  function showError(msg) {
    document.getElementById('error-message').textContent = msg;
  }

  function renderForecast(data) {
    const container = document.getElementById('forecast-container');
    container.innerHTML = '';

    for (let i = 0; i < data.time.length; i++) {
      const date = data.time[i];
      const dayName = getDayName(date);
      const maxTemp = formatTemp(data.temperature_2m_max[i]);
      const minTemp = formatTemp(data.temperature_2m_min[i]);
      const precipitation = data.precipitation_sum[i];
      const precipitationRounded = Math.round(precipitation * 10) / 10;
      const weatherCode = data.weathercode[i];
      const weather = weatherCodeMap[weatherCode] || { text: 'Unknown', icon: 'â“' };

      const card = document.createElement('article');
      card.className = 'day-card';
      card.tabIndex = 0;
      card.setAttribute('aria-label', `${dayName} forecast: ${weather.text}, high ${maxTemp}, low ${minTemp}, precipitation ${precipitationRounded} mm`);

      card.innerHTML = `
        <div class="day-name">${dayName}</div>
        <div class="icon" aria-hidden="true" style="font-size: 48px;">${weather.icon}</div>
        <div class="temp">${maxTemp}</div>
        <div class="temp-min">Low: ${minTemp}</div>
        <div class="precip">Precipitation: ${precipitationRounded} mm</div>
        <div class="description">${weather.text}</div>
      `;

      container.appendChild(card);
    }
  }

  async function fetchForecast(lat, lon) {
    clearError();
    const container = document.getElementById('forecast-container');
    container.innerHTML = '<p>Loading forecast...</p>';
    try {
      // Include daily params for weekly summary
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,weathercode&timezone=auto`;
      const resp = await fetch(url);
      if (!resp.ok) throw new Error('Failed to fetch weather data');
      const data = await resp.json();
      if (!data.daily) throw new Error('No forecast data available');
      renderForecast(data.daily);
    } catch (err) {
      container.innerHTML = '';
      showError(err.message);
    }
  }

  document.getElementById('coord-form').addEventListener('submit', e => {
    e.preventDefault();
    const lat = parseFloat(document.getElementById('latitude').value);
    const lon = parseFloat(document.getElementById('longitude').value);
    if (isNaN(lat) || isNaN(lon)) {
      showError('Please enter valid latitude and longitude');
      return;
    }
    fetchForecast(lat, lon);
  });

  // Load default location on start
  window.addEventListener('load', () => {
    const latInput = document.getElementById('latitude');
    const lonInput = document.getElementById('longitude');
    fetchForecast(parseFloat(latInput.value), parseFloat(lonInput.value));
  });
</script>
</body>
</html>

